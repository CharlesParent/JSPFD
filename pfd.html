<!DOCTYPE html>
<html>
<head>

</head>
<body style='background-color: black; text-align: center'>
	<canvas id="a" width="1050" height="700"></canvas>
</body>
</html>
<script src="jquery-1.11.3.min.js"></script>
<script src="elements.js"></script>
<script src="geodesy/latlon-spherical.js"></script>
<script src="terrain_data.js"></script>

<script src="altimeter_ticker.js"></script>
<script src="airspeed_ticker.js"></script>
<script src="attitude_indicator.js"></script>
<script src="vertical_speed.js"></script>
<script src="profile_display.js"></script>
<script type="text/javascript">

	var GUAGE_BACKGROUND = "#191921";
	var GUAGE_FOREGROUND = "#FFFFFF";
	var BACKGROUND = "#000";
	var GROUND = "#752E00";
	var SKY = "#0072B9";
	var EARTH = "#0B6739";

	var cvs = document.getElementById("a");
  	var ctx = cvs.getContext("2d");

  	var data = {
  		"altitude" : 1200,
  		"airspeed" : 50
  	}


  	guages = []

  	guages[0] = new AttitudeIndicator(ctx, 
  	{
  		"width": 400,
  		"height": 325,
  		"x": 223,
  		"y": 180
  	}, 
  	5, // Angle scale in pixels per degree
  	data);

  	// Altimeter digits ticker
  	guages[1] = new AltimeterTicker(ctx, 
  	{
  		"width": 160,
  		"height": 85,
  		"x": 650,
  		"y": 300 
  	}, 
  	data);

  	// Altimeter digits tape
  	guages[2] = new AltimeterTape(ctx, 
  	{
  		"width": 100,
  		"height": 400,
  		"x": guages[1].loc.x + 163,
  		"y": guages[1].loc.y + guages[1].loc.height / 2 - 200
  	}, 
  	data);

  	// Altimeter digits ticker
  	guages[3] = new AirspeedTicker(ctx, 
  	{
  		"width": 80,
  		"height": 85,
  		"x": 100,
  		"y": 300 
  	}, 
  	data);

  	// Altimeter digits tape
  	guages[4] = new AirspeedTape(ctx, 
  	{
  		"width": 75,
  		"height": 400,
  		"x": guages[3].loc.x - 78,
  		"y": guages[3].loc.y + guages[3].loc.height / 2 - 200
  	}, 
  	data);

  	guages[5] = new VerticalSpeedIndicator(ctx, 
  	{
  		"width": 120,
  		"height": 400,
  		"x": 920,
  		"y": guages[1].loc.y + guages[1].loc.height / 2 - 200 
  	}, 
  	33, // font size in pixels
  	data);

  	guages[6] = new ProfileDisplay(ctx, 
  	{
  		"width": 1050,
  		"height": 120,
  		"x": 0,
  		"y": 10 
  	}, 
  	20,  // Horizontal scale in nm for the whole width
  	70, // Terrain resolution in number of steps to draw
  	50,   // Font size in pixels
  	data);

  	var mousePos = {x: 0, y: 0};
	cvs.addEventListener('mousemove', function(evt) {
		mousePos = getMousePos(cvs, evt);
	}, false);

  	// Reset Canvas
	ctx.fillStyle = BACKGROUND;
  	ctx.fillRect(0, 0, 1100, 1000);

	data.latitude = 48.111435;
	data.longitude = -121.117852;
	data.track = 180;
	data.trueCourse = 180;
	data.heading = 180;
	data.groundSpeed = 100;
	data.airspeed = 100;
	data.altitude = 12000;
	data.verticalSpeed = 0;
	data.bankAngle = 0;
	data.pitchAngle = 20;
	data.turnCoordinationAngle = 0;
	data.terrainAhead = [];

	value = lastValue = 100;
	rate = 10
	vs_acc = 0;
	crs_spd = 0.0;

	var now = then = delta = new Date().getTime();
	var render = function() 
	{   
		now = new Date().getTime();
    	delta = (now - then) / 1000.0;
   		then = now;
   		lastValue = value;
   		value += delta * rate;

   		data.verticalSpeed += vs_acc * delta
   		data.altitude += (data.verticalSpeed / 60.0) * delta;
   		data.trueCourse += crs_spd * delta; 

   		updateAndDraw();

	    // Redraw
	    requestAnimationFrame(render);
	};

	// Start the redrawing process
	render();

	function updateAndDraw()
	{  		
		for (var i = 0; i < guages.length; i++)
  		{
	  		guages[i].update(data);
	  		guages[i].draw();
  		}
	}

	function getMousePos(canvas, evt) {
        var rect = canvas.getBoundingClientRect();
        return {
          x: evt.clientX - rect.left,
          y: evt.clientY - rect.top
        };
      }

</script>
