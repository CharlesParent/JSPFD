<!DOCTYPE html>
<html>
<head>

</head>
<body style='background-color: black'>
	<canvas id="a" width="1050" height="1000"></canvas>
</body>
</html>
<script src="elements.js"></script>
<script src="altimeter_ticker.js"></script>
<script src="airspeed_ticker.js"></script>
<script type="text/javascript">

	var GUAGE_BACKGROUND = "#191921";
	var GUAGE_FOREGROUND = "#FFFFFF";
	var BACKGROUND = "#000";
	var GROUND = "#752E00";
	var SKY = "#0072B9";

	var cvs = document.getElementById("a");
  	var ctx = cvs.getContext("2d");

  	var data = {
  		"altitude" : 1200,
  		"airspeed" : 50
  	}


  	guages = []

  	// Altimeter digits ticker
  	guages[0] = new AltimeterTicker(ctx, 
  	{
  		"width": 160,
  		"height": 85,
  		"x": 720,
  		"y": 300 
  	}, 
  	data);

  	// Altimeter digits tape
  	guages[1] = new AltimeterTape(ctx, 
  	{
  		"width": 100,
  		"height": 400,
  		"x": guages[0].loc.x + 163,
  		"y": guages[0].loc.y + guages[0].loc.height / 2 - 200
  	}, 
  	data);

  	// Altimeter digits ticker
  	guages[2] = new AirspeedTicker(ctx, 
  	{
  		"width": 80,
  		"height": 85,
  		"x": 100,
  		"y": 300 
  	}, 
  	data);

  	// Altimeter digits tape
  	guages[3] = new AirspeedTape(ctx, 
  	{
  		"width": 75,
  		"height": 400,
  		"x": guages[2].loc.x - 78,
  		"y": guages[2].loc.y + guages[2].loc.height / 2 - 200
  	}, 
  	data);


	var loc = {
  		"width": 400,
  		"height": 325,
  		"x": 260,
  		"y": 180
  	}

  	var mousePos = {x: 0, y: 0};
	cvs.addEventListener('mousemove', function(evt) {
		mousePos = getMousePos(cvs, evt);
	}, false);

  	// Reset Canvas
	ctx.fillStyle = BACKGROUND;
  	ctx.fillRect(0, 0, 1100, 1000)

	var now = then = delta = new Date().getTime();
	value = 100;
	rate = 100
	var render = function() 
	{   
		now = new Date().getTime();
    	delta = (now - then) / 1000.0;
   		then = now;

   		value += delta * rate;
   		data.altitude = value
   		data.airspeed = value / 100

   		// drawAttitude(loc, (mousePos.y - 500) / 10, - (500 - mousePos.x) / 10, 5)
   		drawAttitude(loc, 20 * Math.cos(value / 50), 20 * Math.sin(value / 100), 3 * Math.sin(value / 100), 5)
   		updateAndDraw();

	    // Redraw
	    requestAnimationFrame(render);
	};

	// Start the redrawing process
	render();


	function updateAndDraw()
	{  		
		for (var i = 0; i < guages.length; i++)
  		{
	  		guages[i].update(data);
	  		guages[i].draw();
  		}
	}

	function getMousePos(canvas, evt) {
        var rect = canvas.getBoundingClientRect();
        return {
          x: evt.clientX - rect.left,
          y: evt.clientY - rect.top
        };
      }
	

	function drawAttitude(loc, pitchAngle, bankAngle, turnCoordinationDegrees, pixelsPerDegree)
	{
		var x = loc.x;
		var y = loc.y;
		var wid = loc.width;
		var hei = loc.height;

		ctx.save();
		ctx.rect(x, y, wid, hei);
		ctx.clip();

		ctx.translate(x + wid / 2, y + hei / 2);

		ctx.rotate(bankAngle * Math.PI / 180);
		ctx.translate(0, pixelsPerDegree * pitchAngle);

		ctx.fillStyle = SKY;
		ctx.fillRect(- wid, -1000, 2 * wid, 1000);
		ctx.fillStyle = GROUND;
		ctx.fillRect(- wid, 0, 2 * wid, 1000);
		ctx.fillStyle = GUAGE_FOREGROUND;
		ctx.fillRect(- wid, 0, 2 * wid, 1);

		var WIDTH_TEN = 100;
		var WIDTH_FIVE = 50;

		for (var i = -90; i < 90; i += 5)
		{
			ctx.fillStyle = GUAGE_FOREGROUND;
			ctx.font = "15px Arial";
			ctx.textAlign = "center"
			ctx.textBaseline = 'middle';
			var newY = - i * (pixelsPerDegree)
			if (i % 10 == 0 && i != 0)
			{
				ctx.fillRect(- WIDTH_TEN / 2, newY, WIDTH_TEN, 1);
				ctx.fillText(i, - WIDTH_TEN / 2 - 20, newY);
				ctx.fillText(i, + WIDTH_TEN / 2 + 20, newY);
			}
			else if (i != 0)
			{
				ctx.fillRect(- WIDTH_FIVE / 2, newY, WIDTH_FIVE, 1);
			}
		}

		ctx.restore();
		ctx.save();
		ctx.translate(x + wid / 2, y + hei / 2);

		ctx.fillStyle = "#000";
		ctx.strokeStyle = GUAGE_FOREGROUND;
		ctx.beginPath();
		ctx.moveTo(-125, -3);
		ctx.lineTo(-50, -3);
		ctx.lineTo(-50, 20);
		ctx.lineTo(-56, 20);
		ctx.lineTo(-56, 3);
		ctx.lineTo(-125, 3);
		ctx.closePath();
		ctx.stroke();
		ctx.fill();

		ctx.beginPath();
		ctx.moveTo(125, -3);
		ctx.lineTo(50, -3);
		ctx.lineTo(50, 20);
		ctx.lineTo(56, 20);
		ctx.lineTo(56, 3);
		ctx.lineTo(125, 3);
		ctx.closePath();
		ctx.stroke();
		ctx.fill();

		var boxWidth = 15;

		ctx.rect(-boxWidth, -boxWidth, 2 * boxWidth, 2 * boxWidth);
		ctx.stroke();
		ctx.fill();

		ctx.fillStyle = GUAGE_FOREGROUND;
		ctx.beginPath();
		ctx.arc(turnCoordinationDegrees * pixelsPerDegree, 0, boxWidth - 2, 0, 2 * Math.PI);
		ctx.stroke();
		ctx.fill();

		ctx.restore();
	}

</script>
